<!doctype html>

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="/styles/house.css" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>[ Kayomn ]</title>
	</head>

	<body>
		<header><a href="/"><img src="/media/logo.png" /></a></header>

		<main style="min-height: 700px;">
			<article class="columns">
				<div style="min-width: 70%;">
					<div class="title">Articles</div>
					<div id="blog-feed"></div>

					<script type="module">
						import {fetchBlogPosts} from "/scripts/cms.js"

						window.addEventListener("load", async () => {
							const blogFeed = document.getElementById("blog-feed")
							const postLimit = 10
							const posts = (await fetchBlogPosts(blogPostLimit)).data

							if (posts) {
								const htmlBlocks = []

								for (const post of posts) {
									const date = new Date(post.date_updated)

									htmlBlocks.push(`<div style="animation: slide-right 0.4s ease;">
										<a href="./blog?post=${post.id}" class="subtitle">${post.title}</a>
										<div>Posted ${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()}</div>
										<p>${post.body.substring(0, 256)}...</p>
									</div>`)
								}

								blogFeed.innerHTML = htmlBlocks.join("\n")
							} else {
								blogFeed.innerHTML = `<div style="font-style: italic;">Blog feed temporarily unavailable.</div>`
							}
						})
					</script>
				</div>

				<div style="min-width: 30%;">
					<div class="title">Projects</div>
					<div>Check out my <a href="https://github.com/kayomn">GitHub</a> profile to see what I'm working on right now.</div>
					<div id="github-feed"></div>

					<script type="module">
						window.addEventListener("load", async () => {
							const githubFeed = document.getElementById("github-feed")

							const repos = await fetch("https://api.github.com/users/kayomn/repos")
								.then(response => response.json())
								.catch(_ => [])

							if (repos.length) {
								const htmlBlocks = []

								for (const repo of repos.sort((a, b) => (b.stargazers_count - a.stargazers_count))) {
									if (!repo.fork) htmlBlocks.push(`<div style="animation: slide-up 0.4s ease; margin: 15px 0;">
										<a class="subtitle" href="${repo.html_url}">${repo.name}</a>
										<div>${repo.description || `<span style="font-style: italic;">No description.</span>`}</div>
									</div>`)
								}

								githubFeed.innerHTML = htmlBlocks.join("\n")
							} else {
								githubFeed.innerHTML = `<div style="font-style: italic;">Github feed temporarily unavailable.</div>`
							}
						})
					</script>
				</div>
			</article>
		</main>

		<footer>
			<div>Website by Kayomn &copy; 2019 - 2022.</div>
		</footer>
	</body>
</html>
