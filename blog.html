<!doctype html>

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="/styles/house.css" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>[ Kayomn ]</title>
	</head>

	<body>
		<header><a href="/"><img src="/media/logo.png" /></a></header>

		<main style="min-height: 700px;">
			<article id="blog-article" class="letter"></article>
			<script src="https://unpkg.com/commonmark@0.29.3/dist/commonmark.js"></script>

			<script type="module">
				import {fetchBlogPost} from "/scripts/cms.js"

				const searchParams = new URLSearchParams(window.location.search)
				const postID = searchParams.get("post")

				if (postID) {
					window.addEventListener("load", async () => {
						const blogArticle = document.getElementById("blog-article")
						const post = (await fetchBlogPost(postID)).data

						if (post) {
							const body = post.body
							const wordsPerMinute = 225;

							blogArticle.innerHTML = `<div class="title">${post.title}</div>

							<div style="animation: slide-right 0.4s ease;">
								<div>Posted ${new Date(post.date_updated).toLocaleDateString(navigator.languages)}</div>
								<div>${Math.ceil(body.trim().split(/\s+/).length / wordsPerMinute)} minute read.</div>
								<div>${new commonmark.HtmlRenderer().render(new commonmark.Parser().parse(body))}</div>
							</div>`
						} else {
							blogArticle.innerHTML = `<div style="font-style: italic;">Could not fetch blog post associated with the given ID.</div>`
						}
					})
				} else {
					console.warn("Attempt to get blog without post ID, redirecting to `/`");

					document.location.href = "/";
				}
			</script>
		</main>

		<footer>
			<div>Website by Kayomn &copy; 2019 - 2022.</div>
		</footer>
	</body>
</html>
