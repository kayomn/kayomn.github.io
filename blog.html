<!doctype html>

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="/styles/house.css" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>[ Kayomn ]</title>
	</head>

	<body>
		<header><a href="/"><img src="/media/logo.png" /></a></header>

		<main style="min-height: 700px;">
			<article id="blog-article" class="letter"></article>
			<script src="https://unpkg.com/commonmark@0.29.3/dist/commonmark.js"></script>

			<script>
				window.addEventListener("load", async () => {
					const url = "https://cms.kayomn.net/"
					const searchParams = new URLSearchParams(window.location.search)

					if (searchParams.has("post")) {
						const blogArticle = document.getElementById("blog-article")

						const post = await fetch(`${url}items/blog/${searchParams.get("post")}`)
							.then(response => response.json())
							.catch(_ => {})

						if (post.data) {
							const postData = post.data

							const author = await fetch(`${url}users/${postData.user_created}`)
								.then(response => response.json())
								.catch(_ => {})

							if (author.data) {
								const date = new Date(postData.date_updated)
								const body = postData.body
								const wordsPerMinute = 225;

								blogArticle.innerHTML = `<div class="title">${postData.title}</div>

								<div style="animation: slide-right 0.4s ease;">
									<div>Posted ${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()} by ${author.data.username}</div>
									<div>${Math.ceil(body.trim().split(/\s+/).length / wordsPerMinute)} minute read.</div>
									<div>${new commonmark.HtmlRenderer().render(new commonmark.Parser().parse(body))}</div>
								</div>`
							}
						} else {
							blogFeed.innerHTML = `<div style="font-style: italic;">Could not fetch blog post associated with the given ID.</div>`
						}
					}
				})
			</script>
		</main>

		<footer>
			<div>Website by Kayomn &copy; 2019 - 2022.</div>
		</footer>
	</body>
</html>
